<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
  <script src="https://cdn.staticfile.org/vue/2.2.2/vue.min.js"></script>
  <title>云可</title>
</head>

<body>
  <noscript>
    <strong>We're sorry but kumoko doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
  </noscript>
  <div id="app">
    <div>名字：<span v-if="!isEdit">{{user.name}}</span><input v-else v-model="user.name" /><button @click="editName">{{isEdit?'保存':'修改'}}</button></div>
    <div>云币：{{user.money}}</div>
    <div>打工点数：{{user.baitoPoint}}</div>
    <div>道具：{{user.items.length == 0?'无':user.items.join(",")}}</div>
    <div>自动存档：{{user.autoSave?"已开启":"未开启"}}<button @click="editAutoSave">{{user.autoSave?'关闭':'开启'}}</button></div>
    <button @click="saveGame">存档</button><button @click="outputSave">导出存档</button><button @click="inputSave">导入存档</button>
    <div>
      <div>菜单</div>
      <div><button @click="changeModel(index)" v-for="(item, index) in menu" :disabled="!(user.lockMenu.indexOf(index) > -1 || (user.lockMenu.indexOf(index) == -1 && user.money >= item.lock))"><span>{{user.lockMenu.indexOf(index) == -1 && user.money >= item.lock?'解锁':''}}</span>{{item.name}}</button></div>
    </div>
    <div>{{menu[pageNum].name}}</div>
    <div v-if="pageNum == 0">
      <button @click="startBaito(index)" v-for="(item, index) in baitoMenu" :disabled="!(user.lockBaito.indexOf(index) > -1 || (user.lockBaito.indexOf(index) == -1 && user.baitoPoint >= item.lock))">{{item.name}}</button>
    </div>
    <div v-else-if="pageNum == 1">
      <div v-for="(item, index) in shop">
        <div>{{item.name}}：</div>
        <div v-for="(item1, index1) in item.list">
          <div>{{item1.name}}-{{item1.money}}元/1<button @click="shopBuy(index1)">购买</button></div>
        </div>
      </div>
    </div>
    <div v-else>锐意制作中！</div>
  </div>
  <script>
    new Vue({
      el: '#app',
      data: {
        user: {
          name: "云可",
          money: 0,
          autoSave: false,
          lockMenu: [0, 1], // 已解锁功能
          baitoPoint: 0, // 打工点数
          lockBaito: [0], // 已解锁打工
          items: [], // 拥有道具
        },
        pageNum: 0,
        isEdit: false,
        menu: [{ name: '打工', lock: 0 },
        { name: '商店', lock: 0 },
        { name: '种地', lock: 50 },
        { name: '挖矿', lock: 100 },
        { name: '合成', lock: 200 },
        { name: '冒险', lock: 200 }],
        // 打工相关
        baitoMenu: [{ name: '整理', money: 10, lock: 0, time: 5, point: 1 },
        { name: '跑腿', money: 30, lock: 10, time: 10, point: 2 },
        { name: '出售', money: 80, lock: 20, time: 20, point: 5 },
        { name: '社长', money: 100, lock: 50, time: 30, point: 10 }],
        // 商店相关
        shop: [{ name: "道具", list: [] },
        { name: "种子", list: [{ name: "bt种子", money: 10 }] }]
      },
      methods: {
        // 打工
        startBaito(index) {
          let user = this.user
          let item = this.baitoMenu[index]
          if (user.lockBaito.indexOf(index) > -1) {
            this.user.money = this.user.money + this.baitoMenu[index].money
            this.user.baitoPoint = user.baitoPoint + item.point
          } else if (user.lockBaito.indexOf(index) == -1 && user.baitoPoint >= item.lock) {
            this.user.baitoPoint = user.baitoPoint - item.lock
            this.user.lockBaito.push(index)
            alert("已解锁 " + item.name)
            this.user.money = this.user.money + this.baitoMenu[index].money
          }
          if (this.user.autoSave) {
            this.saveGame()
          }
        },
        // 商店
        shopBuy(index) {
          alert("锐意制作中！")
        },
        // 系统
        changeModel(index) {
          let user = this.user
          let item = this.menu[index]
          if (user.lockMenu.indexOf(index) > -1) {
            this.pageNum = index
          } else if (user.lockMenu.indexOf(index) == -1 && user.money >= item.lock) {
            this.user.money = user.money - item.lock
            this.user.lockMenu.push(index)
            alert("已解锁 " + item.name)
            this.pageNum = index
          }
          if (this.user.autoSave) {
            this.saveGame()
          }
        },
        editAutoSave() {
          let autoSave = this.user.autoSave
          if (autoSave) {
            this.user.autoSave = false
          } else {
            this.user.autoSave = true
          }
          this.saveGame()
        },
        editName() {
          if (this.isEdit) {
            this.isEdit = false
          } else {
            this.isEdit = true
          }
          if (this.user.autoSave) {
            this.saveGame()
          }
        },
        outputSave() {
          alert("锐意制作中！")
        },
        inputSave() {
          alert("锐意制作中！")
        },
        saveGame() {
          let data = JSON.stringify(this.user)
          let str64 = window.btoa(data)
          localStorage.setItem("kumokoData", str64)
        },
        loadGame() {
          let str64 = localStorage.getItem("kumokoData")
          if (str64) {
            let data = window.atob(str64)
            this.user = JSON.parse(data)
          }
        }
      },
      mounted() {
        this.loadGame()
      },
    })
  </script>
</body>

</html>